version: '3'
services:
  backend:
    build: .
    volumes:
      # Persist the storage directory (uploads and data.json)
      - ./backend_data:/app/storage
    restart: always
    # Mac/Ubuntu compatibility: Ensure default user can write to mapped volume if issues arise
    # user: "1000:1000" 

  tunnel:
    image: cloudflare/cloudflared:latest
    restart: always
    # Permanent Tunnel (Token provided by user)
    environment:
      - TUNNEL_TOKEN=eyJhIjoiNjIzOGZiN2RjMjk2M2NmZmJkZjFjZDQxZTQ0ZjdkMGYiLCJ0IjoiMDY0MzY0MDEtYjRhYy00MzEyLWExZGEtMzRlMTZkNWVjZTZkIiwicyI6Ik1qY3pOR05rTnpVdE0ySmxZaTAwTW1GaExXSmhZVFV0TTJZd09UWTVOek14TXpZeCJ9
    command: tunnel run
