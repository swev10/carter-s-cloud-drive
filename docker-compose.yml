version: '3'
services:
  backend:
    build: .
    volumes:
      # Persist the storage directory (uploads and data.json)
      - ./backend_data:/app/storage
    restart: always
    # Mac/Ubuntu compatibility: Ensure default user can write to mapped volume if issues arise
    # user: "1000:1000" 

  tunnel:
    image: cloudflare/cloudflared:latest
    restart: always
    # Permanent Tunnel (Token provided by user)
    environment:
      - TUNNEL_TOKEN=eyJhIjoiNjIzOGZiN2RjMjk2M2NmYmRmMWMzNDFlNDQzN2QwZiIsInQiOiI1OTliNmExZi0yNDZjLTQ2ZTgtYTA4Yi05YmYyZDdmYzViZTEiLCJzIjoiT0RNaE16ZzFOR0l0WlRkaU15MDBZakkxTFdKaFlUTXRPQ2hhTVRjME5qRmtZVFkxIn0
    command: tunnel run
