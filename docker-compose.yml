version: '3'
services:
  backend:
    build: .
    volumes:
      # Persist the storage directory (uploads and data.json)
      - ./backend_data:/app/storage
    restart: always
    # Mac/Ubuntu compatibility: Ensure default user can write to mapped volume if issues arise
    # user: "1000:1000" 

  tunnel:
    image: cloudflare/cloudflared:latest
    restart: always
    # Permanent Tunnel (Token provided by user)
    environment:
      - TUNNEL_TOKEN=eyJhIjoiNjIzOGZiN2RjMjk2M2NmZmJkZjFjZDQxZTQ0ZjdkMGYiLCJ0IjoiNTk5YjZhMWYtMjQ2Yy00NmU4LWEwOGItOWJmMmQ3ZmM1YmUxIiwicyI6Ik9ETmhNemcxTkdJdFpUZGlNeTAwWWpKakxXSmhZVE10T0daaE1UYzBOakZrWVRZMSJ9
    command: tunnel run
